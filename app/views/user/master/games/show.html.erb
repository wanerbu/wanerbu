<% content_for :sub_menu do %>
  <%= render :partial => 'user/master/games/sub_menu_start', :locals => {:active_path => nil } -%>
    <li class="active">
      <%= link_to t('user.nav.main_menu.common.show', model: Game.model_name.human), user_master_game_path(@game) %>
    </li>
  <%= render 'common_parts/sub_menu_end' -%>
<% end %>

<div class='wb-content-sub-title'>
  <div>
    <%= link_to t('views.defaults.actions.edit'), edit_user_master_game_path(@game), {class: "btn btn-primary"} %>
    <button type="button" data-toggle="modal"class= "btn btn-primary" data-target="#newPriceRuleModal"><%= t('views.defaults.actions.new_game_price_rule')%></button>
    <button type="button" data-toggle="modal"class= "btn btn-primary" data-target="#newPriceRuleModal"><%= t('views.defaults.actions.new_game_reservation_rule')%></button>
    <%= link_to t('views.defaults.actions.destroy'), user_master_game_path(@game), 
                { method: :delete, class: "btn btn-primary", confirm: t('activemodel.confirm.destroy') } %>
  </div>
  <div class='wb-clear-both'></div>
</div>

<!-- new price rule Modal -->
<div id="newPriceRuleModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="newPriceRuleModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="newPriceRuleModalLabel"><%=t('views.defaults.actions.new_game_price_rule') %></h3>
    </div>
    <%= form_tag(:controller => "games", :action => "new_price_rule", :method => "post") do %>
    <div class="modal-body">
      <%= hidden_field_tag 'price_rule[game_id]', @game.id %>
      <li id="price_type" class="number input optional numeric stringish">
        <label class=" label" for="price_type">
        <%= GamePriceRule.human_attribute_name(:rule_type) %>
          <abbr title="required">*</abbr>
        </label>
        <%= select_tag('price_rule[rule_type]', options_for_select([[GamePriceRule.human_attribute_name(:week_value), '00'], [GamePriceRule.human_attribute_name(:date_value), '01']])) %>
      </li>
      <div id="select_week_price_rule">
        每周<%= text_field_tag('price_rule[week_value]') %>
      </div>
      <div id="select_date_price_rule" style="display: none;">
        <%= date_select :price_rule, :date_value %>
      </div >
      <div id="price_rule">
        的<%= time_select :price_rule, :start_time %> 至
        <%= time_select :price_rule, :end_time %>的价格为
        <%= text_field_tag('price_rule[price]') %>元
        <% court = Court.find(@game.court_id) %>
        <%if court.reservation_type.according_time?%>
          <%=court.min_unit%> 小时
        <%else %>
          <%=court.min_unit%>人次
        <%end%>
      </div >
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true"><%= t('views.defaults.actions.cancel') %></button>
        <%= submit_tag(t('views.defaults.actions.new_game_price_rule')) %>
    </div>
    <% end %>
</div>


<div class="wb-content-detail">
  <table class="table table-bordered" style="width: 100%;">
    <tbody>
      <tr>
        <td><%=Sport.model_name.human%></td>
        <td><%= Sport.find(Court.find(@game.court_id).sport_id).name + "(" + Court.find(@game.court_id).reservation_type.text + ")" -%></td>
      </tr>
      <tr>
        <td><%= Game.human_attribute_name(:name) %></td>
        <td><%= @game.name -%></td>
      </tr>
      <tr>
        <td><%= Game.human_attribute_name(:sort) %></td>
        <td><%= @game.sort -%></td>
      </tr>
      <tr>
        <td><%= Game.human_attribute_name(:default_price) %></td>
        <td><%= @game.default_price -%></td>
      </tr>
      <tr>
        <td><%= Game.human_attribute_name(:can_reservation) %></td>
        <td>
          <% if @game.can_reservation%> 
            <%= t('views.defaults.game.reservation_true')%>
          <%else%>
            <%= t('views.defaults.game.reservation_false')%>
          <%end%>
        </td>
      </tr>
    </tbody>
  </table>
</div>
